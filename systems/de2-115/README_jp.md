この説明では、LinuxとGNU makeを使用することを想定しています。
プラットフォームは未検証です。  このシステムは、DE2-115開発ボードをターゲットにしています。
DE2-115をベースとしたTpadやVeek開発ボードでも実行可能です。
をベースにしています。


## 環境設定

ビルドするためには、インテルツールのソースが必要です。  最も簡単な方法は
は、Nios 2コマンドシェルを実行することです。
`/opt/intelFPGA_pro/18.1/nios2eds/nios2_command_shell.sh` (以下のように置き換えます)
/opt/intelFPGA_pro/18.1は、あなたのツールがインストールされている場所に置き換えてください）。

米国以外の英語圏の言語では、環境変数 `LC_ALL` を設定する必要があるかもしれません。
環境変数 `LC_ALL` を設定する必要があります。


## ビルド

ビルドプロセスはコマンドラインから完全に行うことができます。
Makefile (`make` を実行するだけです)。  また、`make gui-quartus` を実行することで、プロジェクトを作成し、Quartus を開くことができます。
を実行すると、プロジェクトが作成され、Quartusが開かれるので、そこからGUIツールを使うことができます。

QSYSシステムを変更したい場合（例えば、ORCAパラメータを変更したり、別の周辺機器を追加したりする場合）、`make gui-quartus` を実行します。
QSYSシステムを変更したい場合（例えばORCAパラメータを変更したり、別のペリフェラルを追加したり）、`make gui-qsys`を実行してQSYSシステムを作成し、QSYS GUIを開くことができます。
QSYS GUIを開いてください。  変更内容を保存した後、`make`を実行してコマンドラインでシステムを構築します。
または`make gui-quartus` を実行してQSYSシステムを生成し、Quartusを開きます。
を実行し、Quartusを開いてください。


## プログラミング

Makefileにはpgmとrunターゲットが含まれています。  make pgm`はビットストリームをボードにダウンロードします。
ビットストリームをボードにダウンロードします。  make run` はビルドされたプログラムを
software/ディレクトリから構築されたプログラムを命令メモリにロードし、プロセッサをリセットします。

make runを使用した場合、出力はHEX上で確認することができません。その場合は
make terminal-run`コマンドを使うと、プログラムの出力を見ることができます。このようにすると
出力はターミナル経由で見ることができる。


## ORCAパラメータだけを変更する

ORCAのパラメータだけを変更してシステムを作りたい場合は、Makefileにパラメータを渡すことで、以下のようにすることができます。
Makefileにパラメータを渡すことで実現できます。  もしオプションの `config.mk` ファイルが存在するならば、それはMakefileに含まれます。
が存在する場合、それはMakefileに含まれ、これらのパラメータを置くのに良い場所となります。
パラメータを置くのに適した場所です。  例えば、`PIPELINE_STAGES` を 4 に設定するには、次の行を追加します。
PIPELINE_STAGES=4`という行を `config.mk` に追加します。


## ソフトウェア

software/`ディレクトリはmakeを使用してビルドされます。  softwareディレクトリでmakeを実行すると
を実行すると、シミュレーションや電源投入時のBRAMの初期化に必要な.coeファイルがビルドされます。
をビルドします。  de2-115 Makefileは、プロジェクトやシミュレーションを初期化する際に、自動的に.coeファイルをビルドします。
プロジェクトやシミュレーションを初期化する際に自動的にビルドされます。

新しいプログラムを実行しデバッグするには、`make run`コマンドを使用します。
JTAG経由でプログラムをダウンロードします。  これは、プロセッサをリセット状態に保持するスクリプトを実行します、
新しいプログラムをダウンロードした後、リセットを解除してプログラムの実行を許可します。

ソフトウェアのビルド方法については、ソフトウェアディレクトリのREADME.mdを参照してください。


## シミュレーション

シミュレーションを行うには、まず`make sim`を実行します。  これにより、QSYSのテストベンチが構築され、Modelsimが起動します。
Modelsimを起動します。  add_wave_*`コマンドは、特定のORCAユニットのすべての信号を追加するために用意されています。
add_wave_*`コマンドは、特定のORCAユニットのすべての信号を追加するために用意されています（例：`add_wave_instruction_fetch`）。  コマンドは
add_wave_all`は、すべてのORCA信号を波形に追加します。


## ブロックRAMの初期化

ブロックRAMは、software/test.hexのファイルによって初期化され、起動時に動作します。
によって初期化されます。  現在、BRAMを更新するには、ビルドスクリプト全体を再実行する必要があります。
そのため、software/test.hexとビットストリームの間の依存関係はMakefileに含まれていません。
をMakefileに含めていません。  現在、最も効果的な設計フローは、`make run`を使用してプログラムをデバッグすることです。
プログラムをデバッグするために `make run` を使ってランタイムにロードし、プログラムがデプロイできるようになった後で、ビットストリームを再メークすることです。
BRAMを初期化するために、ビットストリームをゼロから作り直す（`make clean && make` ）ことです。
を使用してBRAMを初期化することです。

ビットストリーム生成後にBRAMの内容を更新することも可能であるべきです。
BRAMの初期化スクリプトは、将来のリリースに向けて開発中です。